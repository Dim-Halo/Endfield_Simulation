# Endfield Combat Simulator - é¡¹ç›®ç»“æ„

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: Endfield Combat Simulator (æ˜æ—¥æ–¹èˆŸï¼šç»ˆæœ«åœ° æˆ˜æ–—æ¨¡æ‹Ÿå™¨)
**æ€»ä»£ç è¡Œæ•°**: ~7200è¡Œ (ä¸å«è™šæ‹Ÿç¯å¢ƒ)
**Pythonæ–‡ä»¶æ•°**: 52ä¸ª
**æ¶æ„æ¨¡å¼**: äº‹ä»¶é©±åŠ¨ + Tick-basedæ¨¡æ‹Ÿ

## ğŸ“ ç›®å½•ç»“æ„

```
endfield_sim/
â”œâ”€â”€ ğŸ“ core/                    (1475è¡Œ) - æ ¸å¿ƒè®¡ç®—å’Œæ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ calculator.py           # 14ä¹˜åŒºä¼¤å®³è®¡ç®—å¼•æ“
â”‚   â”œâ”€â”€ damage_helper.py        # ç»Ÿä¸€ä¼¤å®³å¤„ç†æ¥å£ â­
â”‚   â”œâ”€â”€ enums.py                # æšä¸¾å®šä¹‰(å…ƒç´ ã€æ‹›å¼ç±»å‹ã€ååº”ç±»å‹ç­‰)
â”‚   â”œâ”€â”€ stats.py                # å±æ€§æ•°æ®ç±»(CombatStats, Attributes)
â”‚   â”œâ”€â”€ formulas.py             # è¾…åŠ©è®¡ç®—å…¬å¼(é˜²å¾¡ã€æŠ—æ€§)
â”‚   â”œâ”€â”€ config_manager.py       # é…ç½®ç®¡ç†å™¨(å•ä¾‹æ¨¡å¼)
â”‚   â”œâ”€â”€ statistics.py           # æˆ˜æ–—ç»Ÿè®¡ç³»ç»Ÿ(DPSã€ä¼¤å®³åˆ†å¸ƒ)
â”‚   â”œâ”€â”€ operator_config.py      # å¹²å‘˜é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ weapon_system.py        # æ­¦å™¨ç³»ç»Ÿ
â”‚   â””â”€â”€ weapon_effects.py       # æ­¦å™¨æ•ˆæœå¤„ç†
â”‚
â”œâ”€â”€ ğŸ“ simulation/              (706è¡Œ) - æ¨¡æ‹Ÿå¼•æ“
â”‚   â”œâ”€â”€ engine.py               # SimEngine - æ ¸å¿ƒæ¨¡æ‹Ÿå¼•æ“ â­
â”‚   â”œâ”€â”€ snapshot_engine.py      # SnapshotEngine - å¿«ç…§æ•è·å¼•æ“ (æ–°å¢)
â”‚   â”œâ”€â”€ event_system.py         # EventBusäº‹ä»¶æ€»çº¿ç³»ç»Ÿ â­
â”‚   â”œâ”€â”€ action.py               # ActionåŠ¨ä½œç³»ç»Ÿ
â”‚   â”œâ”€â”€ party_manager.py        # é˜Ÿä¼èµ„æºç®¡ç†(æŠ€åŠ›)
â”‚   â””â”€â”€ presets.py              # é¢„è®¾é˜Ÿä¼é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ entities/                (2337è¡Œ) - æ¸¸æˆå®ä½“
â”‚   â”œâ”€â”€ dummy.py                # æ•Œäººç›®æ ‡å‡äºº(å¸¦å¤±è¡¡ç³»ç»Ÿ)
â”‚   â””â”€â”€ characters/             # è§’è‰²å®ç°
â”‚       â”œâ”€â”€ base_actor.py       # BaseActoråŸºç±» â­
â”‚       â”‚                       # - é¢æ¿ç¼“å­˜æœºåˆ¶
â”‚       â”‚                       # - åŠ¨ä½œé˜Ÿåˆ—ç®¡ç†
â”‚       â”‚                       # - æ—¶é—´è½´æ¨¡å¼æ”¯æŒ
â”‚       â”‚
â”‚       â”œâ”€â”€ levatine_sim.py     # è±ç“¦æ±€
â”‚       â”œâ”€â”€ levatine_constants.py
â”‚       â”œâ”€â”€ chen_sim.py         # é™ˆåƒè¯­
â”‚       â”œâ”€â”€ chen_constants.py
â”‚       â”œâ”€â”€ erdila_sim.py       # è‰¾å°”é»›æ‹‰
â”‚       â”œâ”€â”€ erdila_constants.py
â”‚       â”œâ”€â”€ admin_sim.py        # ç®¡ç†å‘˜
â”‚       â”œâ”€â”€ admin_constants.py
â”‚       â”œâ”€â”€ antal_sim.py        # å®‰å¡”å°”
â”‚       â”œâ”€â”€ antal_constants.py
â”‚       â”œâ”€â”€ dapan_sim.py        # å¤§æ½˜
â”‚       â”œâ”€â”€ dapan_constants.py
â”‚       â”œâ”€â”€ guard_sim.py        # éªå«
â”‚       â”œâ”€â”€ guard_constants.py
â”‚       â”œâ”€â”€ wolfguard_sim.py    # ç‹¼å«
â”‚       â””â”€â”€ wolfguard_constants.py
â”‚
â”œâ”€â”€ ğŸ“ mechanics/               (1038è¡Œ) - æ¸¸æˆæœºåˆ¶
â”‚   â”œâ”€â”€ buff_system.py          # Buffç®¡ç†ç³»ç»Ÿ â­
â”‚   â”‚                           # - ç‰ˆæœ¬è·Ÿè¸ªæœºåˆ¶(ç¼“å­˜ä¼˜åŒ–)
â”‚   â”‚                           # - å¿«ç…§è®¡ç®—
â”‚   â”‚                           # - ååº”å¢å¼º
â”‚   â”œâ”€â”€ reaction_manager.py     # å…ƒç´ ååº”ç³»ç»Ÿ â­
â”‚   â”‚                           # - å…ƒç´ é™„ç€
â”‚   â”‚                           # - ååº”è§¦å‘(çˆ†å‘/ç‡ƒçƒ§/å¯¼ç”µ/å†»ç»“/è…èš€)
â”‚   â””â”€â”€ qte_system.py           # QTEè§¦å‘ç³»ç»Ÿ
â”‚
â”œâ”€â”€ ğŸ“ tests/                   (109è¡Œ) - å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_config_manager.py  # é…ç½®ç®¡ç†å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_reaction_manager.py # ååº”ç³»ç»Ÿæµ‹è¯•
â”‚   â””â”€â”€ test_chars_debug.py     # è§’è‰²è°ƒè¯•æµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ“ ui/                      (297è¡Œ) - Legacy UI
â”‚   â”œâ”€â”€ battle_sim.py           # Streamlitæˆ˜æ–—æ¨¡æ‹Ÿç•Œé¢
â”‚   â”œâ”€â”€ char_manage.py          # è§’è‰²ç®¡ç†ç•Œé¢
â”‚   â””â”€â”€ timeline_editor.py      # æ—¶é—´è½´ç¼–è¾‘å™¨
â”‚
â”œâ”€â”€ ğŸ“ web/                     - Reactå‰ç«¯
â”‚   â”œâ”€â”€ src/                    # TypeScript + Reactæºç 
â”‚   â”‚   â”œâ”€â”€ App.tsx             # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/         # UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ store/              # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ api/                # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ dist/                   # æ„å»ºè¾“å‡º
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ ğŸ“ docs/                    - æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE_UPGRADE.md # v2.0æ¶æ„å‡çº§æ–‡æ¡£
â”‚   â”œâ”€â”€ QTE_SYSTEM_GUIDE.md     # QTEç³»ç»Ÿä½¿ç”¨æŒ‡å—
â”‚   â”œâ”€â”€ OPERATOR_CONFIG_GUIDE.md # å¹²å‘˜é…ç½®æŒ‡å—
â”‚   â”œâ”€â”€ WEAPON_SYSTEM_GUIDE.md  # æ­¦å™¨ç³»ç»Ÿæ–‡æ¡£
â”‚   â””â”€â”€ USER_GUIDE.md           # ç”¨æˆ·ä½¿ç”¨æŒ‡å—
â”‚
â”œâ”€â”€ ğŸ“„ å…¥å£æ–‡ä»¶                 (1235è¡Œ)
â”‚   â”œâ”€â”€ main.py                 # CLIå…¥å£(52è¡Œ)
â”‚   â”œâ”€â”€ app.py                  # Streamlit UIå…¥å£(640è¡Œ)
â”‚   â””â”€â”€ api_server.py           # FastAPIåç«¯æœåŠ¡å™¨(543è¡Œ)
â”‚
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ CLAUDE.md               # Claude Codeé¡¹ç›®æŒ‡å— â­
â”‚   â”œâ”€â”€ LICENSE                 # MITè®¸å¯è¯
â”‚   â”œâ”€â”€ README.md               # é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”‚   â””â”€â”€ .gitignore
â”‚
â””â”€â”€ ğŸ“„ å…¶ä»–
    â””â”€â”€ .venv/                  # Pythonè™šæ‹Ÿç¯å¢ƒ

â­ = æ ¸å¿ƒæ¨¡å—
```

## ğŸ”„ æ•°æ®æµå‘

```
ç”¨æˆ·è¾“å…¥ (CLI/Web/Streamlit)
    â†“
API Server / main.py
    â†“
SimEngine.run() [simulation/engine.py]
    â†“ (æ¯ä¸ªtick)
BaseActor.on_tick() [entities/characters/base_actor.py]
    â†“
Action.execute() â†’ DamageEventè§¦å‘
    â†“
deal_damage() [core/damage_helper.py] â† ç»Ÿä¸€ä¼¤å®³å…¥å£
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. attacker.get_current_panel()             â”‚ â† é¢æ¿å¿«ç…§(å¸¦ç¼“å­˜)
â”‚ 2. target.reaction_mgr.apply_hit()          â”‚ â† å…ƒç´ ååº”
â”‚ 3. attacker.buffs.apply_reaction_enhancements() â”‚
â”‚ 4. DamageEngine.calculate()                 â”‚ â† 14ä¹˜åŒºè®¡ç®—
â”‚ 5. EventBus.emit(PRE_DAMAGE)                â”‚ â† äº‹ä»¶ç³»ç»Ÿ
â”‚ 6. target.take_damage()                     â”‚ â† åº”ç”¨ä¼¤å®³
â”‚ 7. statistics.record_damage()               â”‚ â† ç»Ÿè®¡è®°å½•
â”‚ 8. EventBus.emit(POST_DAMAGE)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
SnapshotEngine.capture_snapshot() (å¦‚æœä½¿ç”¨)
    â†“
è¿”å›ç»“æœ â†’ å‰ç«¯æ¸²æŸ“
```

## ğŸ“¦ æ¨¡å—èŒè´£

### Core (æ ¸å¿ƒå±‚)
- **calculator.py**: çº¯è®¡ç®—å‡½æ•°,å®ç°14ä¹˜åŒºä¼¤å®³å…¬å¼
- **damage_helper.py**: ç»Ÿä¸€ä¼¤å®³å¤„ç†æ¥å£,åè°ƒæ‰€æœ‰ç³»ç»Ÿ
- **enums.py**: ç±»å‹å®šä¹‰,ç¡®ä¿ç±»å‹å®‰å…¨
- **stats.py**: æ•°æ®ç»“æ„å®šä¹‰
- **config_manager.py**: å…¨å±€é…ç½®ç®¡ç†(å•ä¾‹)
- **statistics.py**: æˆ˜æ–—æ•°æ®æ”¶é›†å’Œåˆ†æ

### Simulation (æ¨¡æ‹Ÿå±‚)
- **engine.py**: Tick-basedæ¨¡æ‹Ÿå¾ªç¯,äº‹ä»¶è°ƒåº¦
- **snapshot_engine.py**: æ‰©å±•å¼•æ“,æ”¯æŒå¿«ç…§æ•è·
- **event_system.py**: å‘å¸ƒ-è®¢é˜…äº‹ä»¶ç³»ç»Ÿ
- **action.py**: åŠ¨ä½œå’Œäº‹ä»¶çš„æ—¶é—´è½´ç®¡ç†
- **party_manager.py**: é˜Ÿä¼çº§èµ„æº(æŠ€åŠ›)

### Entities (å®ä½“å±‚)
- **base_actor.py**: è§’è‰²åŸºç±»,æä¾›é€šç”¨åŠŸèƒ½
- **characters/*_sim.py**: å…·ä½“è§’è‰²å®ç°
- **dummy.py**: æ•Œäººç›®æ ‡,å¸¦ååº”ç®¡ç†å™¨

### Mechanics (æœºåˆ¶å±‚)
- **buff_system.py**: Buffç”Ÿå‘½å‘¨æœŸç®¡ç†,å¿«ç…§è®¡ç®—
- **reaction_manager.py**: å…ƒç´ é™„ç€å’Œååº”è§¦å‘
- **qte_system.py**: æ¡ä»¶è§¦å‘ç³»ç»Ÿ

## ğŸ¯ å…³é”®è®¾è®¡æ¨¡å¼

1. **äº‹ä»¶é©±åŠ¨**: EventBusè§£è€¦å„ç³»ç»Ÿ
2. **å¿«ç…§æ¨¡å¼**: é¢æ¿è®¡ç®—æ—¶è·å–å½“å‰çŠ¶æ€å¿«ç…§
3. **å•ä¾‹æ¨¡å¼**: ConfigManagerå…¨å±€å”¯ä¸€
4. **å·¥å‚æ¨¡å¼**: è§’è‰²çš„åŠ¨ä½œåˆ›å»ºæ–¹æ³•
5. **ç­–ç•¥æ¨¡å¼**: ä¸åŒçš„Buffç±»å‹
6. **è§‚å¯Ÿè€…æ¨¡å¼**: QTEæ¡ä»¶ç›‘å¬

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **é¢æ¿ç¼“å­˜**: BaseActorä¸­çš„ç‰ˆæœ¬åŒ–ç¼“å­˜æœºåˆ¶
2. **é¿å…æ·±æ‹·è´**: BuffManagerç›´æ¥ä¿®æ”¹å­—å…¸
3. **äº‹ä»¶ä¼˜å…ˆçº§**: é«˜ä¼˜å…ˆçº§äº‹ä»¶å…ˆæ‰§è¡Œ
4. **å»¶è¿Ÿè®¡ç®—**: ä»…åœ¨éœ€è¦æ—¶è®¡ç®—é¢æ¿

## ğŸ“ˆ ä»£ç è´¨é‡

- **æµ‹è¯•è¦†ç›–**: 6ä¸ªå•å…ƒæµ‹è¯•,è¦†ç›–æ ¸å¿ƒåŠŸèƒ½
- **ç±»å‹æç¤º**: çº¦60%è¦†ç›–ç‡
- **æ–‡æ¡£**: å®Œæ•´çš„CLAUDE.mdæŒ‡å—
- **æ—¥å¿—**: ç»Ÿä¸€çš„loggingç³»ç»Ÿ

## ğŸ”§ å¼€å‘å·¥å…·

- **Python**: 3.10+
- **å‰ç«¯**: React + TypeScript + Vite
- **åç«¯**: FastAPI
- **UI**: Streamlit (Legacy)
- **æµ‹è¯•**: unittest

## ğŸ“ æœ€è¿‘ä¼˜åŒ– (2026-01-18)

1. âœ… æ¸…ç†æ³¨é‡Šä»£ç (~30è¡Œ)
2. âœ… æå–SnapshotEngineåˆ°ç‹¬ç«‹æ¨¡å—(~140è¡Œé‡å¤ä»£ç æ¶ˆé™¤)
3. âœ… æ·»åŠ é¢æ¿ç¼“å­˜æœºåˆ¶(30-50%æ€§èƒ½æå‡)
4. âœ… ä¼˜åŒ–Buffç³»ç»Ÿdeepcopyå¼€é”€
5. âœ… æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
6. âœ… ç»Ÿä¸€å¯¼å…¥ç»„ç»‡(PEP 8)
7. âœ… ä¿®å¤æµ‹è¯•ç”¨ä¾‹,æ‰€æœ‰æµ‹è¯•é€šè¿‡

## ğŸ® ä¸‰ç§ä½¿ç”¨æ–¹å¼

1. **CLIæ¨¡å¼**: `python main.py` - å¿«é€Ÿæµ‹è¯•
2. **Streamlit UI**: `streamlit run app.py` - äº¤äº’å¼å¯è§†åŒ–
3. **Webåº”ç”¨**: `python api_server.py` + `cd web && npm run dev` - ç°ä»£åŒ–ç•Œé¢

---

**ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-01-18
**ç‰ˆæœ¬**: v2.0 (ä¼˜åŒ–ç‰ˆ)
