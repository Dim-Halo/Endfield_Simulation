# 终末地战斗模拟器 - 使用指南

## 项目简介

终末地战斗模拟器是一个基于Python的《明日方舟：终末地》战斗模拟系统，支持多角色编队、元素反应、伤害计算等完整战斗机制。

## 环境要求

- Python 3.8+
- Node.js 16+ (用于Web前端)
- 推荐使用虚拟环境

## 安装步骤

### 1. 克隆项目

```bash
git clone <repository-url>
cd endfield_sim
```

### 2. 安装Python依赖

```bash
# 创建虚拟环境（推荐）
python -m venv .venv

# 激活虚拟环境
# Windows:
.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 3. 安装前端依赖（可选）

```bash
cd web
npm install
cd ..
```

## 使用方式

项目提供三种使用方式：

### 方式一：命令行界面（CLI）

最简单的使用方式，适合快速测试。

```bash
python main.py
```

**功能**：
- 运行预设的角色编队
- 查看战斗日志
- 输出伤害统计

### 方式二：Streamlit Web界面

提供可视化的交互界面，适合调试和分析。

```bash
streamlit run app.py
```

访问 http://localhost:8501

**功能**：
- 可视化角色属性和Buff状态
- 实时查看战斗过程
- 图表展示伤害分布

### 方式三：React Web应用（推荐）

功能最完整的现代化Web界面。

**启动后端**：
```bash
python api_server.py
```

**启动前端**：
```bash
cd web
npm run dev
```

访问 http://localhost:5174

**功能**：
- 编队管理：选择角色、配置武器
- 排轴编辑：可视化时间轴编辑器
- 干员管理：自定义角色属性
- 模拟结果：详细的伤害统计和图表

## 核心功能说明

### 1. 编队配置

在Web界面的"编队与设置"页面：

1. **选择角色**：点击位置卡片，从下拉列表选择角色
2. **配置武器**：为角色选择武器（可选）
3. **特殊状态**：某些角色有特殊状态配置（如莱瓦汀的熔火层数）
4. **敌人设置**：配置敌人的防御、抗性等属性
5. **战斗时长**：设置模拟的战斗时长（秒）

### 2. 排轴编辑

在"排轴编辑"页面：

1. **添加动作**：点击时间轴添加技能释放时间点
2. **调整时间**：拖动动作节点调整释放时间
3. **删除动作**：点击动作节点的删除按钮
4. **预览**：实时预览技能释放顺序

### 3. 干员管理

在"干员管理"页面：

1. **查看属性**：显示当前编队中所有角色的属性
2. **编辑属性**：点击"编辑属性"按钮修改角色属性
   - 等级
   - 四维属性（力量、敏捷、智识、意志）
   - 基础面板（生命、攻击、防御、技艺强度）
3. **保存修改**：修改会实时保存到配置中

### 4. 查看结果

在"模拟结果"页面：

1. **总览**：查看总伤害、DPS、战斗时长
2. **角色统计**：每个角色的详细伤害数据
3. **技能分解**：每个技能的伤害占比
4. **伤害时间轴**：可视化伤害分布图表
5. **战斗日志**：详细的战斗事件记录

## 高级功能

### 自定义角色配置

使用干员配置系统保存和加载自定义属性：

1. 在干员管理页面修改属性
2. 配置会自动保存到 `operator_configs.json`
3. 下次使用时自动加载

### 武器系统

为角色装备武器以增强属性：

1. 武器提供攻击力加成
2. 武器提供属性加成（如暴击率、暴击伤害）
3. 武器可能有特殊效果（如触发Buff）

### 元素反应

系统支持完整的元素反应机制：

- **元素类型**：热、电、自然、冷、物理
- **反应类型**：
  - 异色爆发（BURST）：不同元素碰撞
  - 燃烧（BURNING）：热元素持续伤害
  - 导电（CONDUCTIVE）：电元素扩散
  - 腐蚀（CORROSION）：自然元素削弱
  - 冰冻（FROZEN）：冷元素控制

## 常见问题

### Q: 如何添加新角色？

A: 需要在 `entities/characters/` 目录下创建新的角色类文件，继承 `BaseActor` 类。详见技术文档。

### Q: 模拟结果不准确怎么办？

A: 检查以下几点：
1. 角色属性是否正确配置
2. 技能释放时间是否合理
3. 敌人属性是否符合实际情况
4. 查看战斗日志确认计算过程

### Q: 如何导出模拟结果？

A: 当前版本支持在浏览器中查看结果，可以通过浏览器的打印功能导出为PDF。

### Q: 支持多目标模拟吗？

A: 当前版本主要支持单目标模拟，多目标功能在开发中。

## 数据文件说明

- `operator_configs.json`：干员自定义配置
- `weapons.json`：武器数据库
- `core/config_manager.py`：游戏常数配置

## 更新日志

查看项目的 Git 提交历史了解最新更新。

## 技术支持

如遇到问题，请查看：
1. 技术文档（`docs/TECHNICAL_GUIDE.md`）
2. 项目 README
3. 相关指南文档（`docs/` 目录）

## 贡献指南

欢迎提交 Issue 和 Pull Request！

开发前请阅读：
- `CLAUDE.md`：项目架构说明
- `docs/TECHNICAL_GUIDE.md`：技术文档
